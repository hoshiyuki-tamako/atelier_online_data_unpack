<!DOCTYPE html>
<html>

<head>
  <title>キャラクタービルダー</title>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/characterBuilder.css">
  <script src="js/main.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/linq@3.2.3/linq.min.js" integrity="sha256-wNfOgqZN3b4Ddw/AMdNgAqUulgfVw9e96maWCY30eBU=" crossorigin="anonymous"></script>

  <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="//unpkg.com/element-ui/lib/umd/locale/en.js"></script>

  <script src="https://unpkg.com/vue-select@latest"></script>
  <link rel="stylesheet" href="https://unpkg.com/vue-select@latest/dist/vue-select.css">

  <script src="https://unpkg.com/v-tooltip"></script>
</head>

<body>
  <div id="app">
    <el-dialog title="" :visible.sync="itemPickerDialogVisible" fullscreen>
      <div class="item-picker-container">
        <el-select v-if="itemPickerShowSort" v-model="itemPickerSort" placeholder="Sort" filterable clearable>
          <el-option v-for="item in itemPickerSortOption" :key="item.value" :label="item.label" :value="item.value"></el-option>
        </el-select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <span>show info</span>
        <el-switch v-model="itemPickerShowStates"></el-switch>
        <el-input v-model="itemPickerFilterKeyword" placeholder="名前 / DF"></el-input>
        <div class="item-picker-items">
          <div v-if="itemPickerShowRemoveIcon" class="item-picker-remove-item" @click="onPickItem()">
            <img class="icon-small" src="img/icon_s/Texture2D/icon_item_s_10790001.png">
          </div>
          <div @click="onPickItem(item)" v-for="item in getFilteredItemPickerItems()">
            <v-popover placement="right-end" trigger="hover">
              <p>{{ item.NAME }}</p>
              <img class="icon-small" :src="'img/icon_s/Texture2D/icon_item_s_' + item.DF + '.png'">
              <template v-if="itemPickerShowStates" slot="popover">
                <div class="equipment-popover">
                  <table>
                    <tr v-for="_item in getItemStates(item)">
                      <th>{{ _item.label }}</th>
                      <td>
                        <span>{{ _item.value }}</span>
                        <span v-if="_item.skillValue">
                          {{ getNumberSignText(_item.skillValue) }} {{ _item.skillValue }}
                        </span>
                      </td>
                    </tr>
                    <tr v-for="(info, i) in [getItemDodge(item)].filter(p => p.skills.length)">
                      <th>回避</th>
                      <td>{{ info.value }}</td>
                    </tr>
                    <tr v-for="(info, i) in [getItemCriticalHit(item)].filter(p => p.skills.length)">
                      <th>クリティカル</th>
                      <td>{{ info.value }}</td>
                    </tr>
                    <tr v-for="element in getItemElements(item)">
                      <th>{{ element.label }}</th>
                      <td>{{ element.value }}{{ element.skillValue ? ` ${getNumberSignText(element.skillValue)} ${element.skillValue}` : '' }}</td>
                    </tr>
                    <tr v-if="item.GROUP_DF">
                      <th>專用</th>
                      <td>
                        <p v-for="character in characterGroupDfLookup[item.GROUP_DF]">
                          <img class="icon-small" :src="`img/chara/Texture2D/icon_chara_all_${character.DF.toString().padStart(4, '0')}_00.png`" :alt="character.NAME">
                        </p>
                      </td>
                    </tr>
                  </table>
                  <br>
                  <div v-for="skill in getItemSkills(item)">
                    <p>{{ skill.name }}</p>
                    <p>{{ skill.detail }}</p>
                    <p>&#x3E;</p>
                  </div>
                </div>
              </template>
            </v-popover>
          </div>
        </div>
      </div>
    </el-dialog>


    <el-dialog @close="onCloseSupportItemDialog" title="" :visible.sync="supportItemEditDialogVisible" width="80%">
      <div class="support-item-edit-dialog">
        <div class="support-item-picker" v-if="supportItemSelected">
          <img class="icon-small" :src="'img/icon_s/Texture2D/icon_item_s_' + supportItemSelected.DF + '.png'" :alt="supportItemSelected.name">
          <el-button @click="itemPickerDialogVisible = true">Pick Item</el-button>
          <el-button @click="onAddSupportItem" type="primary">Add</el-button>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <span>LV 全設定</span>
          &nbsp;&nbsp;
          <el-input-number v-model="supportItemAllLevel" :min="1" size="small" step-strictly></el-input-number>
          <el-button @click="onSetAllSupportItemLevel" type="primary" size="small">確認</el-button>
        </div>
        <div>
          <p>
          </p>
        </div>
        <div>Total: {{ player.supports.length }}</div>
        <table>
          <tr v-for="summary in getSupportItemStatesSummary()">
            <th>{{ summary.label }}</th>
            <th>{{ summary.value }}</th>
          </tr>
          <tr v-for="summary in getSupportItemElementSummary()">
            <th>{{ summary.label }}</th>
            <th>{{ summary.value }}</th>
          </tr>
        </table>
        <div class="support-item-editor-items">
          <div v-for="(item, i) in player.supports">
            <p>
              <el-input-number v-model="player.supportModifier[i].level" :min="0" size="small" step-strictly></el-input-number>
              <el-button @click="onRemoveSupportItem(i)" type="danger" icon="el-icon-delete" circle></el-button>
            </p>
            <p>
              <img class="icon-small" :src="'img/icon_s/Texture2D/icon_item_s_' + item.DF + '.png'">
            </p>
            <table>
              <tr v-for="state in getSupportItemStates(i)">
                <th>{{ state.label }}</th>
                <td>{{ getNumberSignText(state.value) }}{{ state.value }}</td>
              </tr>
              <tr v-for="element in getSupportItemElements(i)">
                <th>{{ element.label }}</th>
                <td>{{ getNumberSignText(element.value) }}{{ element.value }}</td>
              </tr>
              <tr v-if="item.GROUP_DF">
                <th>專用</th>
                <td>
                  <p v-for="character in characters.filter(p => p.GROUP_DF === item.GROUP_DF)">
                    <img class="icon-small" :src="`img/chara/Texture2D/icon_chara_all_${character.DF.toString().padStart(4, '0')}_00.png`" :alt="character.NAME">
                  </p>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </el-dialog>


    
    <el-dialog title="" :visible.sync="mainItemEditorVisible" width="80%">
      <div class="support-item-edit-dialog">
        <table>
          <tr>
            <th>品質 全設定</th>
            <td>
              <el-input-number v-model="mainItemAllQuality" :min="1" size="small" step-strictly></el-input-number>
            </td>
            <td>
              <el-button @click="onConfirmSetAllMainItemQuality" type="primary">確認</el-button>
            </td>
          </tr>
          <tr>
            <th>LV 全設定</th>
            <td>
              <el-input-number v-model="mainItemAllLevel" :min="1" size="small" step-strictly></el-input-number>
            </td>
            <td>
              <el-button @click="onConfirmSetAllMainItemLevel" type="primary">確認</el-button>
            </td>
          </tr>
          <tr>
            <th>特性 全設定</th>
            <td>
              <el-select v-model="mainItemAllSkillId" placeholder="" filterable clearable>
                <el-option v-for="skill in addonSkills" :key="skill.id" :label="skill.name" :value="skill.id"></el-option>
              </el-select>
            </td>
            <td>
              <el-button @click="onConfirmSetAllMainItemSkill" type="primary">確認</el-button>
            </td>
          </tr>
        </table>
      </div>
    </el-dialog>




    <el-dialog title="" :visible.sync="importDialogVisible" width="80%">
      <div>
        <el-input v-model="importString" type="textarea" :autosize="{ minRows: 4 }"></el-input>
        <br>
        <br>
        <el-button @click="onImportFromString" icon="el-icon-check" type="success" circle></el-button>
      </div>
    </el-dialog>

    <el-dialog title="" :visible.sync="exportDialogVisible" width="80%">
      <div>
        <h4>URL</h4>
        <p>
          <el-input :value="getExportUrl()" type="textarea" autosize></el-input>
        </p>
        <br>
        <br>
        <h4>String</h4>
        <p>
          <el-input :value="getExportString()" type="textarea" autosize></el-input>
        </p>
      </div>
    </el-dialog>





    <el-dialog title="" :visible.sync="characterEditDialogVisible" width="80%">
      <div class="character-edit-dialog">
        <div class="character-picker">
          <div @click="onPickCharacter()">
            <img src="img/icon_s/Texture2D/icon_item_s_10790001.png">
          </div>
          <div :class="{ 'selected-character': player.character && character.DF === player.character.DF }" @click="onPickCharacter(character)" v-for="character in characters">
            <img :src="getCharacterImage(character)" :alt="character.NAME">
          </div>
        </div>
        <div class="character-state">
          <div v-if="player.character">
            <h3>{{ player.character.NAME }}</h3>
            <img class="character-image" :src="getCharacterImage(player.character)" :alt="player.character.NAME">
            <table>
              <tr>
                <th>LV</th>
                <td>
                  <el-input-number v-model="player.characterModifier.level" :min="1" size="small" step-strictly></el-input-number>
                </td>
              </tr>
              <tr>
                <th>食事 LV</th>
                <td><el-input-number v-model="player.characterModifier.foodLevel" :min="1" :max="player.characterModifier.level" size="small" step-strictly></el-input-number></td>
              </tr>
              <tr>
                <th>BlazeArt LV</th>
                <td>
                  <el-input-number v-model="player.characterModifier.blazeArtLevel" label="" :min="0" :max="player.character.BA.length ? 5 : 0" size="small" step-strictly></el-input-number>
                </td>
              </tr>
            </table>
            <table>

              <tr v-for="characterState in getCharacterStates()">
                <th>
                  <v-popover placement="right-end" trigger="hover">
                    <span>{{ characterState.label }}</span>
                    <template slot="popover">
                      <div class="character-state-popover">
                        <table>
                          <tr>
                            <th>base</th>
                            <td>{{ characterState.value }}</td>
                          </tr>
                          <tr>
                            <th>food</th>
                            <td>{{ characterState.foodValue }}</td>
                          </tr>
                          <tr v-if="characterState.skills.length">
                            <th>skill</th>
                            <td>
                              <p v-for="skill in characterState.skills">
                                {{ skill.name }} {{ getNumberSignText(skill.effectValue) }}{{ skill.effectValue }}
                              </p>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </template>
                  </v-popover>
                </th>
                <td>
                  <v-popover placement="right-end" trigger="hover">
                    <span>{{ characterState.value + characterState.foodValue + characterState.skillValue }}</span>
                    <template slot="popover">
                      <div class="character-state-popover">
                        <table>
                          <tr>
                            <th>base</th>
                            <td>{{ characterState.value }}</td>
                          </tr>
                          <tr>
                            <th>food</th>
                            <td>{{ characterState.foodValue }}</td>
                          </tr>
                          <tr v-if="characterState.skills.length">
                            <th>skill</th>
                            <td>
                              <p v-for="skill in characterState.skills">
                                {{ skill.name }} {{ getNumberSignText(skill.effectValue) }}{{ skill.effectValue }}
                              </p>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </template>
                  </v-popover>
                </td>
              </tr>


              <tr>
                <th>
                  <v-popover placement="right-end" trigger="hover">
                    <span>回避</span>
                    <template v-if="getCharacterDodgeWithDetail().skills.length" slot="popover">
                      <div class="character-state-popover">
                        <table>
                           <tr>
                            <th>skill</th>
                            <td>
                              <p v-for="skill in getCharacterDodgeWithDetail().skills">
                                {{ skill.name }} {{ getNumberSignText(skill.effectValue) }}{{ skill.effectValue }}
                              </p>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </template>
                  </v-popover>
                </th>
                <td>
                  <v-popover placement="right-end" trigger="hover">
                    <span>{{ getCharacterDodgeWithDetail().value }}</span>
                    <template v-if="getCharacterDodgeWithDetail().skills.length" slot="popover">
                      <div class="character-state-popover">
                        <table>
                           <tr>
                            <th>skill</th>
                            <td>
                              <p v-for="skill in getCharacterDodgeWithDetail().skills">
                                {{ skill.name }} {{ getNumberSignText(skill.effectValue) }}{{ skill.effectValue }}
                              </p>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </template>
                  </v-popover>
                </td>
              </tr>



              <tr>
                <th>
                  <v-popover placement="right-end" trigger="hover">
                    <span>クリティカル</span>
                    <template v-if="getCharacterCriticalHitWithDetail().skills.length" slot="popover">
                      <div class="character-state-popover">
                        <table>
                           <tr>
                            <th>skill</th>
                            <td>
                              <p v-for="skill in getCharacterCriticalHitWithDetail().skills">
                                {{ skill.name }} {{ getNumberSignText(skill.effectValue) }}{{ skill.effectValue }}
                              </p>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </template>
                  </v-popover>
                </th>
                <td>
                  <v-popover placement="right-end" trigger="hover">
                    <span>{{ getCharacterCriticalHitWithDetail().value }}</span>
                    <template v-if="getCharacterCriticalHitWithDetail().skills.length" slot="popover">
                      <div class="character-state-popover">
                        <table>
                           <tr>
                            <th>skill</th>
                            <td>
                              <p v-for="skill in getCharacterCriticalHitWithDetail().skills">
                                {{ skill.name }} {{ getNumberSignText(skill.effectValue) }}{{ skill.effectValue }}
                              </p>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </template>
                  </v-popover>
                </td>
              </tr>



              <tr v-for="element in getCharacterElements()">
                <th>
                  <v-popover placement="right-end" trigger="hover">
                    <span>{{ element.label }}</span>
                    <template v-if="element.value" slot="popover">
                      <div class="character-state-popover">
                        <table>
                          <tr>
                            <th>skill</th>
                            <td>
                              <p v-for="skill in element.skills">
                                {{ skill.name }} {{ getNumberSignText(skill.effectValue) }}{{ skill.effectValue }}
                              </p>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </template>
                  </v-popover>
                </th>
                <td>
                  <v-popover placement="right-end" trigger="hover">
                    <span>{{ element.value }}</span>
                    <template v-if="element.value" slot="popover">
                      <div class="character-state-popover">
                        <table>
                          <tr>
                            <th>skill</th>
                            <td>
                              <p v-for="skill in element.skills">
                                {{ skill.name }} {{ getNumberSignText(skill.effectValue) }}{{ skill.effectValue }}
                              </p>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </template>
                  </v-popover>
                </td>
              </tr>
            </table>

  
            <div>
              <div v-for="skill in getFilteredSkills(getCharacterSkills())">
                <v-popover placement="right-end" trigger="hover">
                  <p>{{ skill.name }}</p>
                  <template v-if="skill.detail || skill.state.length || skill.stateOwn.length" slot="popover">
                    <div class="character-skill-popover">
                      <p class="character-skill-popover-detail">{{ skill.detail }}</p>
                      <div v-for="(state in skill.state">
                        <p>{{(state.rate * 100).toFixed()}}% {{ abnormalStateLookup[state.id].name }}</p>
                      </div>
                      <div v-for="(state in skill.stateOwn">
                        <p>{{(state.rate * 100).toFixed()}}% {{ abnormalStateLookup[state.id].name }}</p>
                      </div>
                    </div>
                  </template>
                </v-popover>
              </div>
            </div>
          </div>
        </div>
      </div>
    </el-dialog>



    <div class="container" v-loading="pageLoading">
      <div class="main-equipment">
        <div class="left-equipment">
          <template v-for="equipmentSlot in ['weapon', 'shield', 'helmet', 'cloth']">
            <v-popover placement="right-end" trigger="hover">
              <div class="equipment-icon">
                <p>品質 {{ player.equipmentModifier[equipmentSlot].quality }} LV {{ player.equipmentModifier[equipmentSlot].level }} </p>
                <img @click="onPickEquipment(equipmentSlot)" :src="getEquipmentImage(equipmentSlot)">
              </div>
              <template v-if="player.equipment[equipmentSlot]" slot="popover">
                <div class="equipment-popover">
                  <h3>{{ player.equipment[equipmentSlot].NAME }}</h3>
                  <table>
                    <tr>
                      <th>品質</th>
                      <td>
                        <el-input-number v-model="player.equipmentModifier[equipmentSlot].quality" :min="1" size="small" step-strictly></el-input-number>
                      </td>
                    </tr>
                    <tr>
                      <th>LV</th>
                      <td><el-input-number v-model="player.equipmentModifier[equipmentSlot].level" :min="1" size="small" step-strictly></el-input-number></td>
                    </tr>
                    <tr>
                      <th>特性</th>
                      <td>
                        <v-select class="skill-addon-select" :options="addonSkills" label="name" :value="player.equipmentModifier[equipmentSlot].skill" @input="value => setEquipmentModifierSkill(value, equipmentSlot)"></v-select>
                      </td>
                    </tr>
                  </table>

                  <table>
                    <tr v-for="item in getEquipmentStates(equipmentSlot)">
                      <th>{{ item.label }}</th>
                      <td>{{ item.value }}{{ (item.skillValue + item.extraValue) ? ` ${getNumberSignText(item.skillValue + item.extraValue)} ${item.skillValue + item.extraValue}` : '' }}</td>
                    </tr>
                    <tr v-if="getEquipmentDodge(equipmentSlot).skills.length">
                      <th>回避</th>
                      <td>{{ getEquipmentDodge(equipmentSlot).value }}</td>
                    </tr>
                    <tr v-if="getEquipmentCriticalHit(equipmentSlot).skills.length">
                      <th>クリティカル</th>
                      <td>{{ getEquipmentCriticalHit(equipmentSlot).value }}</td>
                    </tr>
                    <tr v-for="element in getEquipmentElements(equipmentSlot)">
                      <th>{{ element.label }}</th>
                      <td>{{ element.value }}{{ (element.skillValue + element.extraValue) ? ` ${getNumberSignText(element.skillValue + element.extraValue)} ${element.skillValue + element.extraValue}` : '' }}</td>
                    </tr>
                    <tr v-if="player.equipment[equipmentSlot].GROUP_DF">
                      <th>專用</th>
                      <td>
                        <p v-for="character in characterGroupDfLookup[player.equipment[equipmentSlot].GROUP_DF]">
                          <img class="icon-small" :src="`img/chara/Texture2D/icon_chara_all_${character.DF.toString().padStart(4, '0')}_00.png`" :alt="character.NAME">
                        </p>
                      </td>
                    </tr>
                  </table>
                  <br>
                  <div v-for="skill in getEquipmentSkills(equipmentSlot, true)">
                    <p>{{ skill.name }}</p>
                    <p>{{ skill.detail }}</p>
                    <p>&#x3E;</p>
                  </div>
                </div>
              </template>
            </v-popover>
          </template>
        </div>

        <div class="right-equipment">
          <template v-for="equipmentSlot in [...new Array(3).keys()].map(p => `accessory${p + 1}`)">
            <v-popover placement="right-end" trigger="hover">
              <div class="equipment-icon">
                <p>品質 {{ player.equipmentModifier[equipmentSlot].quality }} LV {{ player.equipmentModifier[equipmentSlot].level }}</p>
                <img @click="onPickEquipment(equipmentSlot)" :src="getEquipmentImage(equipmentSlot)">
              </div>
              <template v-if="player.equipment[equipmentSlot]" slot="popover">
                <div class="equipment-popover">
                  <h3>{{ player.equipment[equipmentSlot].NAME }}</h3>
                  <table>
                    <tr>
                      <th>品質</th>
                      <td>
                        <el-input-number v-model="player.equipmentModifier[equipmentSlot].quality" :min="1" size="small" step-strictly></el-input-number>
                      </td>
                    </tr>
                    <tr>
                      <th>LV</th>
                      <td><el-input-number v-model="player.equipmentModifier[equipmentSlot].level" :min="1" size="small" step-strictly></el-input-number></td>
                    </tr>
                    <tr>
                      <th>特性</th>
                      <td>
                        <v-select class="skill-addon-select" :options="addonSkills" label="name" :value="player.equipmentModifier[equipmentSlot].skill" @input="value => setEquipmentModifierSkill(value, equipmentSlot)"></v-select>
                      </td>
                    </tr>
                  </table>
  
                  <table>
                    <tr v-for="item in getEquipmentStates(equipmentSlot)">
                      <th>{{ item.label }}</th>
                      <td>{{ item.value }}{{ (item.skillValue + item.extraValue) ? ` ${getNumberSignText(item.skillValue + item.extraValue)} ${item.skillValue + item.extraValue}` : '' }}</td>
                    </tr>
                    <tr v-if="getEquipmentDodge(equipmentSlot).skills.length">
                      <th>回避</th>
                      <td>{{ getEquipmentDodge(equipmentSlot).value }}</td>
                    </tr>
                    <tr v-if="getEquipmentCriticalHit(equipmentSlot).skills.length">
                      <th>クリティカル</th>
                      <td>{{ getEquipmentCriticalHit(equipmentSlot).value }}</td>
                    </tr>
                    <tr v-for="element in getEquipmentElements(equipmentSlot)">
                      <th>{{ element.label }}</th>
                      <td>{{ element.value }}{{ (element.skillValue + element.extraValue) ? ` ${getNumberSignText(element.skillValue + element.extraValue)} ${element.skillValue + element.extraValue}` : '' }}</td>
                    </tr>
                    <tr v-if="item.GROUP_DF">
                      <th>專用</th>
                      <td>
                        <p v-for="character in characterGroupDfLookup[item.GROUP_DF]">
                          <img class="icon-small" :src="`img/chara/Texture2D/icon_chara_all_${character.DF.toString().padStart(4, '0')}_00.png`" :alt="character.NAME">
                        </p>
                      </td>
                    </tr>
                  </table>
                  <br>
                  <div v-for="skill in getEquipmentSkills(equipmentSlot, true)">
                    <p>{{ skill.name }}</p>
                    <p>{{ skill.detail }}</p>
                    <p>&#x3E;</p>
                  </div>
                </div>
              </template>
            </v-popover>
          </template>
        </div>
      </div>







      <div class="sub-equipment">
        <div class="sub-equipment-menu">
          <p>
            <el-button @click="importDialogVisible = true" type="warning" round>import</el-button>
            <el-button @click="exportDialogVisible = true" round>export</el-button>
            <el-button @click="onSave" type="primary" round>save</el-button>
            <el-button @click="onClear" type="danger" round>clear</el-button>
          </p>
          <br>
          <p>
            <el-button @click="mainItemEditorVisible = true" type="success" icon="el-icon-edit" circle></el-button>
            <span>Main item</span>
          </p>
          <br>
          <p>
            <el-button @click="openSupportItemEditDialog" type="success" icon="el-icon-edit" circle></el-button>
            <span>Support x {{ player.supports.length }}</span>
          </p>
        </div>
        <div class="sub-equipment-items">
          <div v-for="(item, i) in player.supports">
            <v-popover placement="right-end" trigger="hover">
              <img :src="'img/icon_s/Texture2D/icon_item_s_' + item.DF + '.png'">
              <template slot="popover">
                <div class="equipment-popover">
                  <h3>{{ item.NAME }} (LV {{ player.supportModifier[i].level }})</h3>
                  <table>
                    <tr v-for="state in getSupportItemStates(i)">
                      <th>{{ state.label }}</th>
                      <td>{{ getNumberSignText(state.value) }}{{ state.value }}</td>
                    </tr>
                    <tr v-for="element in getSupportItemElements(i)">
                      <th>{{ element.label }}</th>
                      <td>{{ getNumberSignText(element.value) }}{{ element.value }}</td>
                    </tr>
                    <tr v-if="item.GROUP_DF">
                      <th>キャラクター專用</th>
                      <td>
                        <p v-for="character in characterGroupDfLookup[item.GROUP_DF]">
                          <img class="icon-small" :src="`img/chara/Texture2D/icon_chara_all_${character.DF.toString().padStart(4, '0')}_00.png`" :alt="character.NAME">
                        </p>
                      </td>
                    </tr>
                  </table>
                </div>
              </template>
            </v-popover>
          </div>
        </div>
      </div>





      <div class="result" v-for="(temp, i) in [getSummaryState()]">
        <div class="character">
          <div>
            <h4>
              <span>
                <el-button @click="characterEditDialogVisible = true" type="primary" icon="el-icon-edit" circle></el-button>
              </span>
              <span v-if="player.character">
                {{ player.character.NAME }} (LV {{ player.characterModifier.level }})(食事 LV {{ player.characterModifier.foodLevel }})
                <span v-if="player.character && player.character.BA.length">(BA LV {{ player.characterModifier.blazeArtLevel }})</span>
              </span>
            </h4>
            <img v-if="player.character" :src="getCharacterImage()" :alt="player.character.NAME">
          </div>
        </div>



        <table>
          <tr>
            <th>
              <v-popover placement="left-end" trigger="hover">
                <span>強さ</span>
                <template slot="popover">
                  <div class="equipment-popover">
                    強さ = sum(物攻base + 物防base + 魔攻base + 魔防base)
                  </div>
                </template>
              </v-popover>
            </th>
            <td>
              <v-popover placement="left-end" trigger="hover">
                <span>{{ temp.strength }}</span>
                <template slot="popover">
                  <div class="equipment-popover">
                    強さ = sum(物攻base + 物防base + 魔攻base + 魔防base)
                  </div>
                </template>
              </v-popover>
            </td>
          </tr>
          <tr v-for="summary in temp.totalStates">
            <th>
              <v-popover placement="left-end" trigger="hover">
                <span>{{ summary.label }}</span>
                <template slot="popover">
                  <div class="equipment-popover">
                    <h4>{{ summary.label }}</h4>
                    <table>
                      <tr v-for="characterStates in temp.characterStates.filter(p => p.state === summary.state)">
                        <th>
                          <img class="icon-small" v-if="player.character" :src="getCharacterImage()" :alt="player.character.NAME">
                        </th>
                        <td>base {{ characterStates.value }} / food {{ characterStates.foodValue }} / skill {{ characterStates.skillValue }}</td>
                      </tr>
                      <tr v-for="([slot, [value]]) in temp.equipmentStates.map(p => [p.slot, p.values.filter(p => p.key === summary.state)]).filter(p => p[1].length)">
                        <th>
                          <img class="icon-small" :src="getEquipmentImage(slot)" :alt="slot">
                        </th>
                        <td>base {{ value.value }} / skill {{ value.skillValue }} / extra {{ value.extraValue }}</td>
                      </tr>
                      <tr v-for="support in temp.supportItemStates.filter(p => p.state === summary.state).filter(p => p.value)">
                        <th>Support</th>
                        <td>{{ support.value }}</td>
                      </tr>
                    </table>
                  </div>
                </template>
              </v-popover>
            </th>
            <td>
              <v-popover placement="left-end" trigger="hover">
                <span>{{ summary.value }}</span>
                <template slot="popover">
                  <div class="equipment-popover">
                    <h4>{{ summary.label }}</h4>
                    <table>
                      <tr v-for="(characterStates, i) in temp.characterStates.filter(p => p.state === summary.state)">
                        <th>
                          <img class="icon-small" v-if="player.character" :src="getCharacterImage()" :alt="player.character.NAME">
                        </th>
                        <td>base {{ characterStates.value }} / food {{ characterStates.foodValue }} / skill {{ characterStates.skillValue }}</td>
                      </tr>
                      <tr v-for="([slot, [value]]) in temp.equipmentStates.map(p => [p.slot, p.values.filter(p => p.key === summary.state)]).filter(p => p[1].length)">
                        <th>
                          <img class="icon-small" :src="getEquipmentImage(slot)" :alt="slot">
                        </th>
                        <td>base {{ value.value }} / skill {{ value.skillValue }} / extra {{ value.extraValue }}</td>
                      </tr>
                      <tr v-for="support in temp.supportItemStates.filter(p => p.state === summary.state).filter(p => p.value)">
                        <th>Support</th>
                        <td>{{ support.value }}</td>
                      </tr>
                    </table>
                  </div>
                </template>
              </v-popover>
            </td>
          </tr>
          <tr>
            <th>
              <v-popover placement="left-end" trigger="hover">
                <span>回避</span>
                <template slot="popover">
                  <div class="equipment-popover">
                    <h4>回避</h4>
                    <table>
                      <tr v-if="temp.characterDodge.value">
                        <th>
                          <img class="icon-small" v-if="player.character" :src="getCharacterImage()" :alt="player.character.NAME">
                        </th>
                        <td>{{ temp.characterDodge.value }}</td>
                      </tr>
                      <tr v-for="([slot, value]) in temp.equipmentDodges.map(p => [p.slot, p.values.value]).filter(p => p[1])">
                        <th>
                          <img class="icon-small" :src="getEquipmentImage(slot)" :alt="slot">
                        </th>
                        <td>{{ value }}</td>
                      </tr>
                    </table>
                  </div>
                </template>
              </v-popover>
            </th>
            <td>
              <v-popover placement="left-end" trigger="hover">
                <span>{{ temp.totalDodgeState }}</span>
                <template slot="popover">
                  <div class="equipment-popover">
                    <h4>回避</h4>
                    <table>
                      <tr v-if="temp.characterDodge.value">
                        <th>
                          <img class="icon-small" v-if="player.character" :src="getCharacterImage()" :alt="player.character.NAME">
                        </th>
                        <td>{{ temp.characterDodge.value }}</td>
                      </tr>
                      <tr v-for="([slot, value]) in temp.equipmentDodges.map(p => [p.slot, p.values.value]).filter(p => p[1])">
                        <th>
                          <img class="icon-small" :src="getEquipmentImage(slot)" :alt="slot">
                        </th>
                        <td>{{ value }}</td>
                      </tr>
                    </table>
                  </div>
                </template>
              </v-popover>
            </td>
          </tr>
          <tr>
            <th>
              <v-popover placement="left-end" trigger="hover">
                <span>クリティカル</span>
                <template slot="popover">
                  <div class="equipment-popover">
                    <h4>クリティカル</h4>
                    <table>
                      <tr v-if="temp.characterCriticalHit.value">
                        <th>
                          <img class="icon-small" v-if="player.character" :src="getCharacterImage()" :alt="player.character.NAME">
                        </th>
                        <td>{{ temp.characterCriticalHit.value }}</td>
                      </tr>
                      <tr v-for="([slot, value]) in temp.equipmentCriticalHit.map(p => [p.slot, p.values.value]).filter(p => p[1])">
                        <th>
                          <img class="icon-small" :src="getEquipmentImage(slot)" :alt="slot">
                        </th>
                        <td>{{ value }}</td>
                      </tr>
                    </table>
                  </div>
                </template>
              </v-popover>
            </th>
            <td>
              <v-popover placement="left-end" trigger="hover">
                <span>{{ temp.totalCriticalHitState }}</span>
                <template slot="popover">
                  <div class="equipment-popover">
                    <h4>クリティカル</h4>
                    <table>
                      <tr v-if="temp.characterCriticalHit.value">
                        <th>
                          <img class="icon-small" v-if="player.character" :src="getCharacterImage()" :alt="player.character.NAME">
                        </th>
                        <td>{{ temp.characterCriticalHit.value }}</td>
                      </tr>
                      <tr v-for="([slot, value]) in temp.equipmentCriticalHit.map(p => [p.slot, p.values.value]).filter(p => p[1])">
                        <th>
                          <img class="icon-small" :src="getEquipmentImage(slot)" :alt="slot">
                        </th>
                        <td>{{ value }}</td>
                      </tr>
                    </table>
                  </div>
                </template>
              </v-popover>
            </td>
          </tr>
          <tr v-for="element in temp.totalElements">
            <th>
              <v-popover placement="left-end" trigger="hover">
                <span>{{ element.label }}</span>
                <template slot="popover">
                  <div class="equipment-popover">
                    <h4>{{ element.label }}</h4>
                    <table v-for="([characterElement], i) in [temp.characterElements.filter(p => p.key === element.element)]">
                      <tr v-if="characterElement.value">
                        <th>
                          <img class="icon-small" v-if="player.character" :src="getCharacterImage()" :alt="player.character.NAME">
                        </th>
                        <td>{{ characterElement.value }}</td>
                      </tr>
                      <tr v-for="([slot, [value]]) in temp.equipmentElements.map(p => [p.slot, p.values.filter(i => i.key === element.element)]).filter(p => p[1].length)">
                        <th>
                          <img class="icon-small" :src="getEquipmentImage(slot)" :alt="slot">
                        </th>
                        <td>base {{ value.value }} / skill {{ value.skillValue }} / extra {{ value.extraValue }}</td>
                      </tr>
                      <tr v-for="support in temp.supportElements.filter(i => i.element === element.element).filter(p => p.value)">
                        <th>Support</th>
                        <td>{{ support.value }}</td>
                      </tr>
                    </table>
                  </div>
                </template>
              </v-popover>
            </th>
            <td>
              <v-popover placement="left-end" trigger="hover">
                <span>{{ element.value }}</span>
                <template slot="popover">
                  <div class="equipment-popover">
                    <h4>{{ element.label }}</h4>
                    <table v-for="([characterElement], i) in [temp.characterElements.filter(p => p.key === element.element)]">
                      <tr v-if="characterElement.value">
                        <th>
                          <img class="icon-small" v-if="player.character" :src="getCharacterImage()" :alt="player.character.NAME">
                        </th>
                        <td>{{ characterElement.value }}</td>
                      </tr>
                      <tr v-for="([slot, [value]]) in temp.equipmentElements.map(p => [p.slot, p.values.filter(i => i.key === element.element)]).filter(p => p[1].length)">
                        <th>
                          <img class="icon-small" :src="getEquipmentImage(slot)" :alt="slot">
                        </th>
                        <td>base {{ value.value }} / skill {{ value.skillValue }} / extra {{ value.extraValue }}</td>
                      </tr>
                      <tr v-for="support in temp.supportElements.filter(i => i.element === element.element).filter(p => p.value)">
                        <th>Support</th>
                        <td>{{ support.value }}</td>
                      </tr>
                    </table>
                  </div>
                </template>
              </v-popover>
            </td>
          </tr>
          <tr>
            <th>
              <v-popover placement="left-end" trigger="hover">
                <span>SKILL</span>
                <template v-if="temp.skillMultiplier.skills.length" slot="popover">
                  <div class="equipment-popover">
                    <table>
                      <tr v-for="skill in temp.skillMultiplier.characterSkillMultiplierSkills">
                        <th>
                          <img class="icon-small" v-if="player.character" :src="getCharacterImage()" :alt="player.character.NAME">
                        </th>
                        <td>{{ skill.name }}</td>
                        <td>{{ skill.effectValue }}</td>
                      </tr>
                      <tr v-for="([slot, skill], i) in temp.skillMultiplier.equipmentSkillMultiplierSkills.map(p => p.skills.map(i => [p.slot, i])).flat()">
                        <th>
                          <img class="icon-small" :src="getEquipmentImage(slot)" :alt="slot">
                        </th>
                        <th>{{ skill.name }}</th>
                        <td>{{ skill.effectValue }}</td>
                      </tr>
                    </table>
                  </div>
                </template>
              </v-popover>
            </th>
            <td>
              <v-popover placement="left-end" trigger="hover">
                <span>x {{ (1 + temp.skillMultiplier.value).toFixed(2) }}</span>
                <template v-if="temp.skillMultiplier.skills.length" slot="popover">
                  <div class="equipment-popover">
                    <table>
                      <tr v-for="skill in temp.skillMultiplier.characterSkillMultiplierSkills">
                        <th>
                          <img class="icon-small" v-if="player.character" :src="getCharacterImage()" :alt="player.character.NAME">
                        </th>
                        <td>{{ skill.name }}</td>
                        <td>{{ skill.effectValue }}</td>
                      </tr>
                      <tr v-for="([slot, skill], i) in temp.skillMultiplier.equipmentSkillMultiplierSkills.map(p => p.skills.map(i => [p.slot, i])).flat()">
                        <th>
                          <img class="icon-small" :src="getEquipmentImage(slot)" :alt="slot">
                        </th>
                        <th>{{ skill.name }}</th>
                        <td>{{ skill.effectValue }}</td>
                      </tr>
                    </table>
                  </div>
                </template>
              </v-popover>
            </td>
          </tr>
        </table>
        <br>
        <div>
          <span>Skill Combo</span>
          <el-slider v-model="skillCombo" :step="1" :max="15"></el-slider>
          <small>*現在のskills計算公式わ推測. 誤差があります</small>
        </div>
        <br>
        <div v-for="skill in [getCharacterBlazeArt()].filter(p => p)">
          <h4>Blaze Art (LV {{ player.characterModifier.blazeArtLevel }})</h4>
          <p>{{ skill.name }}</p>
          <p>{{ skill.detail }}</p>
          <div v-if="skill.attribute === 3">
            <table>
              <tr>
                <th>正常</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>魔法攻撃UP中</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.3 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+魔法防御DOWN大</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.3 * 1.4 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+屬性(-100)</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.3 * 1.4 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>全超+-</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.55 * 1.55 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
            </table>
          </div>
          <div v-else-if="skill.attribute">
            <table>
              <tr>
                <th>正常</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>物攻増UP中+</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.35 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+物理防御DOWN大</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.35 * 1.4 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+屬性(-100)</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.35 * 1.4 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>全超+-</th>
                <td>{{  Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.55 * 1.55 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
            </table>
          </div>
        </div>
        <br>
        <div v-for="skill in getEquipmentSkills('weapon').filter(p => p.type === 1)">
          <h4>武器</h4>
          <img class="icon-small" :src="`img/icon_skill/Texture2D/${skill.iconPath}.png`" :alt="skill.name">
          <p>{{ skill.name }}</p>
          <p>{{ skill.detail }}</p>
          <div v-if="skill.attribute === 3">
            <table>
              <tr>
                <th>正常</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>魔法攻撃UP中</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.3 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+魔法防御DOWN大</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.3 * 1.4 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+屬性(-100)</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.3 * 1.4 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>全超+-</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.55 * 1.55 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
            </table>
          </div>
          <div v-else-if="skill.attribute">
            <table>
              <tr>
                <th>正常</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>物攻増UP中+</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.35 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+物理防御DOWN大</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.35 * 1.4 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+屬性(-100)</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.35 * 1.4 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>全超+-</th>
                <td>{{  Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.55 * 1.55 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
            </table>
          </div>
        </div>
        <br>
        <div v-for="skill in getEquipmentSkills('shield').filter(p => p.type === 1)">
          <h4>盾</h4>
          <img class="icon-small" :src="`img/icon_skill/Texture2D/${skill.iconPath}.png`" :alt="skill.name">
          <p>{{ skill.name }}</p>
          <p>{{ skill.detail }}</p>
          <div v-if="skill.attribute === 3">
            <table>
              <tr>
                <th>正常</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>魔法攻撃UP中</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.3 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+魔法防御DOWN大</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.3 * 1.4 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+屬性(-100)</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.3 * 1.4 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>全超+-</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'MATK').value * 1.55 * 1.55 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
            </table>
          </div>
          <div v-else-if="skill.attribute">
            <table>
              <tr>
                <th>正常</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>物攻増UP中+</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.35 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+物理防御DOWN大</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.35 * 1.4 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>上+屬性(-100)</th>
                <td>{{ Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.35 * 1.4 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
              <tr>
                <th>全超+-</th>
                <td>{{  Math.round(temp.totalStates.find(p =&gt; p.state === 'SATK').value * 1.55 * 1.55 * 2 * (1 + skillCombo * .2) * skill.effectValue * (1 + temp.skillMultiplier.value)) }}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="js/characterBuilder.js"></script>
</body>

</html>